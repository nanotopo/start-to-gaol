<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÂèóÈ®ì„Åô„Åî„Çç„Åè</title>

<style>
body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: url("bg.png") center/cover fixed;
}

/* ===== ‰∏äÈÉ®„Éê„Éº ===== */
.top-bar {
  position: fixed;
  top: 6px;
  left: 6px;
  right: 6px;
  display: flex;
  gap: 6px;
  z-index: 20;
}

.menu-btn {
  font-size: 20px;
  background: #4a90e2;
  color: #fff;
  border: none;
  border-radius: 8px;
  padding: 6px 10px;
}

.top-info {
  flex: 1;
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 6px;
}

.info-box {
  background: rgba(255,255,255,0.9);
  border-radius: 10px;
  padding: 6px;
  text-align: center;
  font-size: 11px;
  font-weight: bold;
}

/* ===== Áõ§Èù¢ ===== */
.board {
  margin: 90px 8px 30px;
  padding: 10px;
  display: grid;
  grid-template-columns: repeat(30, 1fr);
  gap: 4px;
}

.cell {
  aspect-ratio: 1 / 1;
  border-radius: 50%;
  border: 2px solid #333;
  background: #fff;
  font-size: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  text-align: center;
}

.past {
  background: #eee;
  border-color: #bbb;
  color: #888;
}

.snake-left  { transform: translateY(-6px); }
.snake-mid   { transform: none; }
.snake-right { transform: translateY(6px); }

.event {
  background: linear-gradient(135deg, #e6d9ff, #c7b7ff);
  border-color: #8b78d6;
}

.today {
  background: linear-gradient(135deg, #fff4cc, #ffe8a3);
  border-color: #f2c94c;
  box-shadow: 0 0 8px rgba(242,201,76,0.6);
}

.month {
  grid-column: 1 / -1;
  text-align: center;
  font-weight: bold;
  font-size: 12px;
  margin: 8px 0 4px;
}

.balloon {
  position: absolute;
  top: -42px;
  background: #ff7675;
  color: #fff;
  font-size: 14px;
  padding: 6px 12px;
  border-radius: 16px;
  white-space: nowrap;
}

.exam-mark {
  position: absolute;
  bottom: 6px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 14px;
}

/* ===== Â∑¶„É°„Éã„É•„Éº ===== */
.side-menu {
  position: fixed;
  inset: 0;
  background: #f5f5f5;
  padding: 12px;
  overflow-y: auto;
  transform: translateY(-100%);
  transition: 0.3s;
  z-index: 30;
}
.side-menu.open { transform: translateY(0); }

.hidden { display: none; }

.side-menu input,
.side-menu select,
.side-menu button {
  width: 100%;
  margin-bottom: 8px;
  padding: 8px;
  font-size: 14px;
}

.list-item {
  padding: 8px;
  border-bottom: 1px solid #ccc;
  cursor: pointer;
}

/* ===== Ê≠ØËªä ===== */
.gear-btn {
  position: fixed;
  right: 12px;
  bottom: 12px;
  font-size: 22px;
  background: #333;
  color: #fff;
  border: none;
  border-radius: 50%;
  width: 44px;
  height: 44px;
  z-index: 40;
}

/* ===== Ë®≠ÂÆö ===== */
.setting {
  position: fixed;
  inset: 0;
  background: #f5f5f5;
  padding: 16px;
  display: none;
  z-index: 50;
}
.setting.open { display: block; }

.setting input, .setting button {
  width: 100%;
  margin-bottom: 10px;
  padding: 8px;
  font-size: 14px;
}
</style>
</head>

<body>

<div class="top-bar">
  <button class="menu-btn" onclick="toggleMenu()">‚â°</button>
  <div class="top-info">
    <div class="info-box" id="infoToday"></div>
    <div class="info-box" id="infoExam"></div>
    <div class="info-box" id="infoLeft"></div>
    <div class="info-box">ÂÅèÂ∑ÆÂÄ§<br><span id="scoreView"></span></div>
  </div>
</div>

<!-- Â∑¶„É°„Éã„É•„Éº -->
<div id="sideMenu" class="side-menu">
  <h3>„Ç§„Éô„É≥„Éà„Éª„Éû„Ç§„É´„Çπ„Éà„Éº„É≥</h3>

  <select id="modeSelect" onchange="changeMode()">
    <option value="add">ËøΩÂä†</option>
    <option value="delete">ÂâäÈô§</option>
  </select>

  <div id="addArea">
    <h4>„Ç§„Éô„É≥„Éà</h4>
    <input type="date" id="eventDate">
    <input type="text" id="eventType">
    <button onclick="addEvent()">ËøΩÂä†</button>

    <h4>„Éû„Ç§„É´„Çπ„Éà„Éº„É≥</h4>
    <input type="date" id="mileDate">
    <input type="text" id="mileText">
    <button onclick="addMilestone()">ËøΩÂä†</button>
  </div>

  <div id="deleteArea" class="hidden"></div>

  <!-- ‚òÖ Èñâ„Åò„Çã„Éú„Çø„É≥ÔºàÁîªÂÉè„Å®Âêå„ÅòÂΩ¢ÂºèÔºâ -->
  <button onclick="toggleMenu()">Èñâ„Åò„Çã</button>
</div>

<div id="board" class="board"></div>

<button class="gear-btn" onclick="openSetting()">‚öôÔ∏è</button>

<div id="setting" class="setting">
  <h3>Ë®≠ÂÆö</h3>
  <input type="number" id="setScore">
  <input type="date" id="setStart">
  <input type="date" id="setExam">
  <button onclick="saveSetting()">‰øùÂ≠ò</button>
  <button onclick="closeSetting()">Èñâ„Åò„Çã</button>
</div>

<script>
const today = new Date();
today.setHours(0,0,0,0);

let startDate = new Date(localStorage.getItem("startDate") || today);
let examDate = new Date(localStorage.getItem("examDate") || "2027-02-10");
let score = localStorage.getItem("score") || 58;

let events = JSON.parse(localStorage.getItem("events") || "{}");
let milestones = JSON.parse(localStorage.getItem("milestones") || "[]");

infoToday.textContent = "‰ªäÊó•\n" + today.toLocaleDateString();
infoExam.textContent = "Ë©¶È®ì\n" + examDate.toLocaleDateString();
infoLeft.textContent = "ÊÆã„Çä\n" + Math.ceil((examDate - today)/86400000) + "Êó•";
scoreView.textContent = score;

const board = document.getElementById("board");
let lastMonth = null;
let i = 0;

while (true) {
  const d = new Date(startDate);
  d.setDate(startDate.getDate() + i);
  if (d > examDate) break;

  if (d.getMonth() !== lastMonth) {
    const m = document.createElement("div");
    m.className = "month";
    m.textContent = d.getMonth()+1 + "Êúà";
    board.appendChild(m);
    lastMonth = d.getMonth();
  }

  const cell = document.createElement("div");
  cell.className = "cell " + ["snake-left","snake-mid","snake-right"][i%3];
  const key = d.toISOString().slice(0,10);

  if (d < today) cell.classList.add("past");

  if (events[key]) {
    cell.classList.add("event");
    cell.textContent = events[key];
  }

  if (d.getTime() === examDate.getTime()) {
    const p = document.createElement("div");
    p.className = "exam-mark";
    p.textContent = "‚úèÔ∏è";
    cell.appendChild(p);
  }

  if (Math.floor((today - startDate)/86400000) === i) {
    cell.classList.add("today");
    cell.innerHTML += "üßç";
  }

  milestones.forEach(m => {
    if (m.date === key) {
      const b = document.createElement("div");
      b.className = "balloon";
      b.textContent = m.text;
      cell.appendChild(b);
    }
  });

  board.appendChild(cell);
  i++;
}

function toggleMenu() {
  sideMenu.classList.toggle("open");
}

function changeMode() {
  addArea.classList.toggle("hidden", modeSelect.value !== "add");
  deleteArea.classList.toggle("hidden", modeSelect.value !== "delete");
  if (modeSelect.value === "delete") renderDelete();
}

function renderDelete() {
  deleteArea.innerHTML = "<h4>ÂâäÈô§</h4>";
  Object.keys(events).forEach(d => {
    const div = document.createElement("div");
    div.className = "list-item";
    div.textContent = d + "Ôºö" + events[d];
    div.onclick = () => { delete events[d]; save(); };
    deleteArea.appendChild(div);
  });

  milestones.forEach((m,i) => {
    const div = document.createElement("div");
    div.className = "list-item";
    div.textContent = m.date + "Ôºö" + m.text;
    div.onclick = () => { milestones.splice(i,1); save(); };
    deleteArea.appendChild(div);
  });
}

function addEvent() {
  if (!eventDate.value || !eventType.value) return;
  events[eventDate.value] = eventType.value;
  save();
}

function addMilestone() {
  if (!mileDate.value || !mileText.value) return;
  milestones.push({date:mileDate.value, text:mileText.value});
  save();
}

function save() {
  localStorage.setItem("events", JSON.stringify(events));
  localStorage.setItem("milestones", JSON.stringify(milestones));
  location.reload();
}

function openSetting() {
  setScore.value = score;
  setStart.value = startDate.toISOString().slice(0,10);
  setExam.value = examDate.toISOString().slice(0,10);
  setting.classList.add("open");
}
function closeSetting() {
  setting.classList.remove("open");
}
function saveSetting() {
  localStorage.setItem("score", setScore.value);
  localStorage.setItem("startDate", setStart.value);
  localStorage.setItem("examDate", setExam.value);
  location.reload();
}
</script>

</body>
</html>
