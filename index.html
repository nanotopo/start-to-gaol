<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å—é¨“ã™ã”ã‚ã</title>

<style>
body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: url("bg.png") center/cover fixed;
}

/* ===== ä¸Šéƒ¨ãƒãƒ¼ ===== */
.top-bar {
  position: fixed;
  top: 6px;
  left: 6px;
  right: 6px;
  display: flex;
  gap: 6px;
  z-index: 20;
}

.menu-btn {
  font-size: 20px;
  background: #4a90e2;
  color: #fff;
  border: none;
  border-radius: 8px;
  padding: 6px 10px;
}

.top-info {
  flex: 1;
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 6px;
}

.info-box {
  background: rgba(255,255,255,0.9);
  border-radius: 10px;
  padding: 6px;
  text-align: center;
  font-size: 11px;
  font-weight: bold;
}

/* ===== ç›¤é¢ ===== */
.board {
  margin: 90px 8px 30px;
  padding: 10px;
  display: grid;
  grid-template-columns: repeat(30, 1fr);
  gap: 4px;
}

.cell {
  aspect-ratio: 1 / 1;
  border-radius: 50%;
  border: 2px solid #333;
  background: #fff;
  font-size: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  text-align: center;
}

/* è›‡è¡Œ */
.snake-left  { transform: translateY(-6px); }
.snake-mid   { transform: none; }
.snake-right { transform: translateY(6px); }

/* ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆè—¤è‰²ï¼‰ */
.event {
  background: linear-gradient(135deg, #e6d9ff, #c7b7ff);
  border-color: #8b78d6;
}

/* ä»Šæ—¥ï¼ˆæ·¡ã„é‡‘è‰²ï¼‰ */
.today {
  background: linear-gradient(135deg, #fff4cc, #ffe8a3);
  border-color: #f2c94c;
  box-shadow: 0 0 8px rgba(242,201,76,0.6);
}

/* ã‚´ãƒ¼ãƒ« */
.goal {
  background: #c2f0c2;
  font-size: 12px;
}

.character {
  position: absolute;
  font-size: 14px;
}

/* æœˆè¡¨ç¤º */
.month {
  grid-column: 1 / -1;
  text-align: center;
  font-weight: bold;
  font-size: 12px;
  margin: 8px 0 4px;
}

/* ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ */
.balloon {
  position: absolute;
  top: -28px;
  background: #ff7675;
  color: #fff;
  font-size: 7px;
  padding: 2px 6px;
  border-radius: 10px;
}

/* ===== ãƒ¡ãƒ‹ãƒ¥ãƒ¼ ===== */
.side-menu {
  position: fixed;
  inset: 0;
  background: #f5f5f5;
  padding: 12px;
  overflow-y: auto;
  transform: translateY(-100%);
  transition: 0.3s;
  z-index: 30;
}
.side-menu.open { transform: translateY(0); }

.hidden { display: none; }

.side-menu input,
.side-menu select,
.side-menu button {
  width: 100%;
  margin-bottom: 8px;
  padding: 8px;
  font-size: 14px;
}

.list-item {
  padding: 8px;
  border-bottom: 1px solid #ccc;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="top-bar">
  <button class="menu-btn" onclick="toggleMenu()">â‰¡</button>
  <div class="top-info">
    <div class="info-box" id="infoToday"></div>
    <div class="info-box" id="infoExam"></div>
    <div class="info-box" id="infoLeft"></div>
    <div class="info-box">åå·®å€¤<br><span id="scoreView"></span></div>
  </div>
</div>

<div id="sideMenu" class="side-menu">
  <h3>ã‚¤ãƒ™ãƒ³ãƒˆãƒ»ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³</h3>

  <select id="modeSelect" onchange="changeMode()">
    <option value="add">è¿½åŠ </option>
    <option value="delete">å‰Šé™¤</option>
  </select>

  <!-- è¿½åŠ  -->
  <div id="addArea">
    <h4>ã‚¤ãƒ™ãƒ³ãƒˆ</h4>
    <input type="date" id="eventDate">
    <input type="text" id="eventType">
    <button onclick="addEvent()">è¿½åŠ </button>

    <h4>ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³</h4>
    <input type="date" id="mileDate">
    <input type="text" id="mileText">
    <button onclick="addMilestone()">è¿½åŠ </button>
  </div>

  <!-- å‰Šé™¤ -->
  <div id="deleteArea" class="hidden"></div>
</div>

<div id="board" class="board"></div>

<script>
const today = new Date();
let startDate = new Date(localStorage.getItem("startDate") || today);
let examDate = new Date(localStorage.getItem("examDate") || "2027-02-10");
let score = localStorage.getItem("score") || 58;

let events = JSON.parse(localStorage.getItem("events") || "{}");
let milestones = JSON.parse(localStorage.getItem("milestones") || "[]");

infoToday.textContent = "ä»Šæ—¥\n" + today.toLocaleDateString();
infoExam.textContent = "è©¦é¨“\n" + examDate.toLocaleDateString();
infoLeft.textContent = "æ®‹ã‚Š\n" + Math.ceil((examDate - today)/86400000) + "æ—¥";
scoreView.textContent = score;

const board = document.getElementById("board");
let lastMonth = null;
let i = 0;

while (true) {
  const d = new Date(startDate);
  d.setDate(startDate.getDate() + i);
  if (d > examDate) break;

  if (d.getMonth() !== lastMonth) {
    const m = document.createElement("div");
    m.className = "month";
    m.textContent = d.getMonth()+1 + "æœˆ";
    board.appendChild(m);
    lastMonth = d.getMonth();
  }

  const cell = document.createElement("div");
  cell.className = "cell " + ["snake-left","snake-mid","snake-right"][i%3];
  const key = d.toISOString().slice(0,10);

  if (events[key]) {
    cell.classList.add("event");
    cell.textContent = events[key];
  }

  if (Math.floor((today-startDate)/86400000) === i) {
    cell.classList.add("today");
    cell.innerHTML += "ğŸ§";
  }

  milestones.forEach(m => {
    if (m.date === key) {
      const b = document.createElement("div");
      b.className = "balloon";
      b.textContent = m.text;
      cell.appendChild(b);
    }
  });

  board.appendChild(cell);
  i++;
}

function toggleMenu() {
  sideMenu.classList.toggle("open");
}

function changeMode() {
  addArea.classList.toggle("hidden", modeSelect.value !== "add");
  deleteArea.classList.toggle("hidden", modeSelect.value !== "delete");
  if (modeSelect.value === "delete") renderDelete();
}

function renderDelete() {
  deleteArea.innerHTML = "<h4>å‰Šé™¤</h4>";
  Object.keys(events).forEach(d => {
    const div = document.createElement("div");
    div.className = "list-item";
    div.textContent = d + "ï¼š" + events[d];
    div.onclick = () => { delete events[d]; save(); };
    deleteArea.appendChild(div);
  });

  milestones.forEach((m,i) => {
    const div = document.createElement("div");
    div.className = "list-item";
    div.textContent = m.date + "ï¼š" + m.text;
    div.onclick = () => { milestones.splice(i,1); save(); };
    deleteArea.appendChild(div);
  });
}

function addEvent() {
  if (!eventDate.value || !eventType.value) return;
  events[eventDate.value] = eventType.value;
  save();
}

function addMilestone() {
  if (!mileDate.value || !mileText.value) return;
  milestones.push({date:mileDate.value, text:mileText.value});
  save();
}

function save() {
  localStorage.setItem("events", JSON.stringify(events));
  localStorage.setItem("milestones", JSON.stringify(milestones));
  location.reload();
}
</script>

</body>
</html>
